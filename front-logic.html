<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Sheet JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.14.3/xlsx.full.min.js"></script>
    <!--FileSaver savaAs 이용 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>
    <title>Document</title>
</head>
<style>
    table {
        border: 1px solid gray;
    }

    td {
        width: 50px;
        border: 1px solid gray;
        text-align: center;
    }
</style>

<body>
    <table id="tableData">
    </table>
    <button type="button" id="excelDownload" class="download">엑셀파일 다운로드</button>

    <script type="text/javascript">
        const excelDownload = document.querySelector('#excelDownload');
        let table = document.querySelector("#tableData");

        let arr = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20];
        let arr2 = [[1, 2, 3, 1, 3, 2, 12, 50, 156], [5, 8, 9, 1, 0, 1546, 122, 123], [5, 6, 4, 1, 2, 5, 4, 8, 8, 1, 56, 1, 2, 2, 4], [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]];


        createTable(arr2);

        function createTable(arr) {
            let tdNum, tdEmpty, hr, hrContent;

            for (let i = 0; i < arr.length; i++) {
                // 구분선
                hr = document.createElement("tr");
                table.appendChild(hr);
                hrContent = document.createElement("td");
                hrContent.appendChild(document.createTextNode("Line: " + i));
                hr.appendChild(hrContent);

                for (let j = 0; j < arr[i].length; j++) {
                    let tdNum = document.createElement("td");
                    let tdEmpty = document.createElement("td");

                    if (j % 16 == 0) {
                        trNum = document.createElement("tr");
                        table.appendChild(trNum);
                        trEmpty = document.createElement("tr");
                        table.appendChild(trEmpty);
                    }

                    tdEmpty.appendChild(document.createTextNode("Null"));
                    trEmpty.appendChild(tdEmpty);

                    tdNum.appendChild(document.createTextNode(arr[i][j]));
                    trNum.appendChild(tdNum);
                }
            }
        }



        // 엑셀
        document.addEventListener('DOMContentLoaded', () => {
            excelDownload.addEventListener('click', exportExcel);
        });

        function exportExcel() {
            // step 1. workbook 생성
            var wb = XLS.utils.book_new();

            // step 2. 시트 만들기 
            var newWorksheet = excelHandler.getWorksheet();

            // step 3. workbook에 새로만든 워크시트에 이름을 주고 붙인다.  
            XLS.utils.book_append_sheet(wb, newWorksheet, excelHandler.getSheetName());

            // step 4. 엑셀 파일 만들기 
            var wbout = XLS.write(wb, { bookType: 'xls', type: 'binary' });

            // step 5. 엑셀 파일 내보내기 
            saveAs(new Blob([s2ab(wbout)], { type: "application/octet-stream" }), excelHandler.getExcelFileName());
        }

        var excelHandler = {
            getExcelFileName: function () {
                return 'test.xls';	//파일명
            },
            getSheetName: function () {
                return 'Table Test Sheet';	//시트명
            },
            getExcelData: function () {
                return document.getElementById('tableData'); 	//TABLE id
            },
            getWorksheet: function () {
                return XLSX.utils.table_to_sheet(this.getExcelData());
            }
        }

        function s2ab(s) {
            var buf = new ArrayBuffer(s.length); //convert s to arrayBuffer
            var view = new Uint8Array(buf);  //create uint8array as viewer
            for (var i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF; //convert to octet
            return buf;
        }
    </script>
</body>

</html>